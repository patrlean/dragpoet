<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- <meta http-equiv="refresh" content="3"> -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>拼贴诗词</title>
    <link href="style.css" type="text/css" rel="stylesheet" />
</head>
<body>
    <div id="拼词页面">
        <div id="开头文字" style="font-family:'myYuan';">
            动动小手从虚框中pick词语开始创作叭~
        </br>
        </div>
        <div id="outerBox">
            
            <span id="量子力学" class="verse" onclick="myFunction(this)" style="background-color: white;">量子力学</span>
            <span id="品学楼" class="verse" onclick="myFunction(this)" style="background-color: white;">品学楼</span>
            <span id="我" class="verse" onclick="myFunction(this)" style="background-color: white;">我</span>
            <span id="爱" class="verse" onclick="myFunction(this)" style="background-color: white;">爱</span>
            <span id="他一" class="verse" onclick="myFunction(this)" style="background-color: white;">他</span>
            <span id="她" class="verse" onclick="myFunction(this)" style="background-color: white;">她</span>
            <span id="麦克斯韦雕像" class="verse" onclick="myFunction(this)" style="background-color: white;">麦克斯韦雕像</span>
            <span id="学子餐厅" class="verse" onclick="myFunction(this)" style="background-color: white;">学子餐厅</span>
            <span id="夕阳" class="verse" onclick="myFunction(this)" style="background-color: white;">夕阳</span>
            <span id="平行宇宙" class="verse" onclick="myFunction(this)" style="background-color: white;">平行宇宙</span>
            <span id="是" class="verse" onclick="myFunction(this)" style="background-color: white;">是</span>
            <span id="的一" class="verse" onclick="myFunction(this)" style="background-color: white;">的</span>
            <span id="心" class="verse" onclick="myFunction(this)" style="background-color: white;">心</span>
            <span id="让我们在一起" class="verse-double" onclick="myFunction(this)" style="background-color: white;">让我们<br/>在一起</span>
            <span id="的二" class="verse" onclick="myFunction(this)" style="background-color: white;">的</span>
            <span id="他二" class="verse" value='0' onclick="myFunction(this)" style="background-color: white;" style="background-color: white;">他</span>
            <span id="永远" class="verse" onclick="myFunction(this)" style="background-color: white;">永远</span>
            <span id="故事" class="verse" onclick="myFunction(this)" style="background-color: white;">故事</span>
            <span id="ta" class="verse" onclick="myFunction(this)" style="background-color: white;">ta</span>
            <span id="小狗" class="verse" onclick="myFunction(this)" style="background-color: white;">小狗</span>
            <span id="姗姗来迟" class="verse" onclick="myFunction(this)" style="background-color: white;">姗姗来迟</span>
            <span id="喜欢" class="verse" onclick="myFunction(this)" style="background-color: white;">喜欢</span>
            <span id="月色" class="verse" onclick="myFunction(this)" style="background-color: white;">月色</span>
        </div>

        <div class="按钮">
            <button type="button" class="按钮" onclick="generateSentence()">生成句子！</button>
            <button type="button" class="按钮" onclick="someMagic()">一点灵感？</button>
        </div>
        <div hidden="hidden">
            <canvas id="myCanvas" width="300" height="400" style="border:2px dashed #000000;"></canvas>
        </div>
    </div>

    <div id="输出图像" style="display: none;text-align: center;">
        <div id="输出图像单独图像">
            <img>
        </div>
        <div class="text" style="font-family:'myYuan'">
            长按图片保存到手机
        </div>
        <div class="按钮">
            <button type="button" onclick="back2page()">返回</button>
        </div>
    </div>
    
<script>
    // 变量定义
    var wordSet = new Array();
    var img = new Image();
    const wordNON = ['量子力学','品学楼','他','她','我','ta','小狗','故事'];
    const wordCONJ = ['是','在','有','能'];
    const wordSTATE = ['让我们在一起'];
    // 函数
    // 加入新词
    function myFunction(obj) {
        elem = document.getElementById(obj.id);
        newWord = elem.innerText;
        // console.log(elem.style.backgroundColor);
        if (elem.style.backgroundColor == "white"){
            elem.style.backgroundColor = "rgb(243, 236, 176)";
            wordSet.push(newWord);
        }
        else{
            elem.style.backgroundColor = "white";
            const index = wordSet.indexOf(newWord);
            if (index > -1) { // 移除找到的指定元素
            wordSet.splice(index, 1); // 移除元素
            }
        }
    }
    
    // 生成句子
    function generateSentence() {
        // 组合句子
        sentence = wordSet.join("");
        // alert(sentence);
        // 创建canvas绘图元素
        var canvas = document.getElementById('myCanvas');
        var ctx = canvas.getContext('2d');
        var ratio = window.devicePixelRatio || 1;
        canvas.style.width = canvas.width + 'px';
        canvas.style.height = canvas.height + 'px';
        canvas.width = canvas.width * ratio;
        canvas.height = canvas.height * ratio;
        ctx.scale(ratio,ratio);

        // var w = canvas.width;
        // var h = canvas.height;
        // canvas.width = w;
        // canvas.height = h;
        // 设置背景颜色
        ctx.fillStyle = '#1b1c20';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // 设置背景文字
        ctx.font="14px Arial";
        ctx.fillStyle = "#ccc1b0";
        ctx.textAlign = "left";
        ctx.fillText(sentence,10,50);

        // 生成图像
        var dataImg = new Image()
        dataImg.src = canvas.toDataURL('image/png',1.0);
        // 设置display变换
        var page = document.getElementById("拼词页面");
        page.style.display = "none";
        var imgPage = document.getElementById("输出图像");
        var imgPageSingle = document.getElementById("输出图像单独图像");
        imgPage.style.display = "block";
        // 固定图片大小
        // imgPageSingle.innerHTML = '<img style="text-align: center;width: 300px;height: 400px" src="' + dataImg.src + '" alt="拼贴诗词" >';
        // width = "300px" height = "400px"
        // 自适应图片大小
        imgPageSingle.innerHTML = '<img style="text-align: center;width: '+ canvas.width + 'px;height:'+ canvas.height +'px" src="' + dataImg.src + '" alt="">';
        
        
    }
    
    // 一点灵感
    // 博尔赫斯
    // 使他觉得遥远的不是时间长，而是两三件不可挽回的事 
    // 世界会变，但是我始终如一。我带着悲哀的自负想到
    // 一朵玫瑰正马不停蹄地成为另一朵玫瑰；你是云、是海、是忘却；你也是你曾失去的每一个自己
    // 失眠是知道别人独睡时自己不该独醒， 是渴望进入梦境而又不能成眠 是对活着和还将继续活下去的恐惧， 是懵懵懂懂熬到天明。
    function someMagic() {
        
    }
    // Converts canvas to an image
    function convertCanvasToImage(canvas) {
        var image = new Image();
        image.src = canvas.toDataURL("image/png");
        return image;
    }
    // 返回页面
    function back2page() {
        var page = document.getElementById("拼词页面");
        page.style.display = "block";
        var imgPage = document.getElementById("输出图像");
        imgPage.style.display = "none";
        javascript:location.reload();
    }
</script>
</body>
</html>